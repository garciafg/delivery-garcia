<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        .body {
            background-color: #000000 !important;
        }
    </style>

</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                    </div>
                    <div class="card-body">
                        <div id="lista-width">
                            <h4>Tamanhos</h4>

                        </div>
                    </div>
                    <div class="card-body">
                        <h4>Sabores</h4>
                        <p>Escolha a quantidade de opções (Max. 2 Opções)</p>
                        <div id="lista-sabores">
                        </div>
                    </div>
                    <div class="card-body">
                        <h4>Sub total</h4>
                        <ul id="itens-cart">
                        </ul>
                        <div id="sub-total">
                        </div>
                </div>
        </div>

</body>

<script>
    
    axios.get('http://localhost:4000/products/1')
        .then(function (response) {
            let h2 = document.createElement('h2');
            h2.innerHTML = response.data.product.name;
            document.querySelector('.card-header').appendChild(h2);
            let ul = document.createElement('ul');
            ul.classList.add('lista-tamanhos');
            response.data.product.tbl_tamanhos.forEach(function (size) {
                let li = document.createElement('li');
                let inputRadio = document.createElement('input');
                inputRadio.setAttribute('type', 'radio');
                inputRadio.setAttribute('name', 'tamanho');
                inputRadio.setAttribute('value', size.id);
                inputRadio.setAttribute('id', size.id);
                li.innerHTML = `${inputRadio.outerHTML} - ${size.name_width}`;
                ul.appendChild(li);
            });
            document.querySelector('#lista-width').appendChild(ul);


            // Ativa os sabores
            let radios = document.querySelectorAll('input[type="radio"]');
            radios.forEach(function (radio) {
                radio.addEventListener('click', function () {
                    let id = this.value;
                    axios.get(`http://localhost:4000/sabores/${id}`)
                    .then(function (response) {

                        let qtdTotal = 0;
                        let qtdAtual;
                        let subTotal = 0;
                        let ulCart = document.querySelector('#itens-cart');
                        let ul = document.createElement('ul');
                        ul.classList.add('lista-sabores');

                        response.data.sabores.forEach(function (sabor) {
                            
                            let li = document.createElement('li');
                            li.innerHTML = `<button class="btn-menos">-</button>
                            <span class="qtd">${qtdTotal}</span>
                            <button class="btn-mais">+</button> <span class="title-item">${sabor.name} R$ - </span> <span class="price-item">${sabor.price}</span>`;
                            ul.appendChild(li);
                            let divSabores = document.querySelector('#lista-sabores');
                            divSabores.innerHTML = '';
                            divSabores.appendChild(ul);
                        });

                        // Adiciona o evento de click no botão de menos
                        let btnMais = document.querySelectorAll('.btn-mais');
                        btnMais.forEach(function (btn) {
                            let liCart = document.createElement('li');
                            btn.addEventListener('click', function () {
                                if(qtdTotal < 2) {
                                    
                                    qtdAtual = parseInt(this.parentElement.querySelector('.qtd').innerHTML);
                                    qtdAtual++;
                                    this.parentElement.querySelector('.qtd').innerHTML = qtdAtual;
                                    subTotal = subTotal + parseFloat(this.parentElement.querySelector('.price-item').innerHTML/2);
                                    document.querySelector('#sub-total').innerHTML = `R$ ${subTotal}`;

                                    let nomeItem = this.parentElement.querySelector('.title-item').innerHTML;
                                    let precoItem = this.parentElement.querySelector('.price-item').innerHTML;
                                    let qtdItem = this.parentElement.querySelector('.qtd').innerHTML;
                                    
                                    liCart.innerHTML = `<li>Qtd. ${qtdItem} - ${nomeItem} R$ ${precoItem}</li>`;
                                    ulCart.appendChild(liCart);
                                    qtdTotal++;

                                }else{
                                    alert('Limite máximo de opções atingido');
                                }
                            });
                        });

                        // Adiciona o evento de click no botão de mais
                        let btnMenos = document.querySelectorAll('.btn-menos');
                        btnMenos.forEach(function (btn) {
                            
                            btn.addEventListener('click', function () {
                                if(qtdAtual >= 1) {
                                    qtdAtual = parseInt(this.parentElement.querySelector('.qtd').innerHTML);
                                    qtdAtual--;
                                    this.parentElement.querySelector('.qtd').innerHTML = qtdAtual;
                                    subTotal = subTotal - parseFloat(this.parentElement.querySelector('.price-item').innerHTML/2);
                                    document.querySelector('#sub-total').innerHTML = `R$ ${subTotal}`;
                                    qtdTotal--;
                                }else{
                                    alert('Limite mínimo de opções atingido');
                                }
                            });
                        });
                    });
                });
            });

        })
        .catch(function (error) {
            console.log(error);
        });

</script>
</html>